<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi Tiết Xe Hơi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
</head>
<body class="bg-gray-100 font-roboto">
<!-- Header -->
<header class="bg-white shadow">
    <div class="container mx-auto flex justify-between items-center py-4 px-6">
        <img alt="Toyota Logo" class="h-10" src="https://www.toyota.com.vn/media/d1pmr5qz/logo-toyota.jpg" width="100"/>
        <nav class="flex space-x-4">
            <a class="text-gray-700 hover:text-red-600" href="#">Sản phẩm</a>
            <a class="text-gray-700 hover:text-red-600" href="#">Công nghệ</a>
            <a class="text-gray-700 hover:text-red-600" href="#">Dịch vụ & bảo hành</a>
            <a class="text-gray-700 hover:text-red-600" href="#">Tin tức</a>
            <a class="text-gray-700 hover:text-red-600" href="#">Tuyển dụng</a>
            <a class="text-gray-700 hover:text-red-600" href="#">Liên hệ</a>
        </nav>
        <div class="flex space-x-4">
            <a class="text-gray-700 hover:text-red-600" href="#"><i class="fas fa-search"></i></a>
            <a class="text-gray-700 hover:text-red-600" href="#"><i class="fas fa-user"></i></a>
            <a class="text-gray-700 hover:text-red-600" href="#"><i class="fas fa-shopping-cart"></i></a>
        </div>
    </div>
</header>

<!-- Carousel Banner -->
<section id="carouselExample" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="https://www.toyota.com.vn/media/30zaec1u/website-banner-1600x680-compressed.png" class="d-block w-100 object-cover" alt="Banner 1">
        </div>
        <div class="carousel-item">
            <img src="https://www.toyota.com.vn/media/er0oxvhk/desktop_hero-banner-1600x680.jpg" class="d-block w-100 object-cover" alt="Banner 2">
        </div>
        <div class="carousel-item">
            <img src="https://www.toyota.com.vn/media/s5vddonh/website_hero-banner-desktop-1600x680px.png" class="d-block w-100 object-cover" alt="Banner 3">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
        <span class="carousel-control-prev-icon bg-black rounded-full p-3" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
        <span class="carousel-control-next-icon bg-black rounded-full p-3" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</section>

<!-- Product Details Section -->
<div class="container mx-auto px-4 py-12 space-y-12">
    <div class="bg-white p-8 rounded-lg shadow-lg">
        <div class="flex flex-wrap">
            <!-- Main Image Display -->
            <div class="w-full md:w-1/2">
                <img th:src="@{'/images/' + ${images[0]?.imageName}}" alt="Ảnh xe hơi" class="w-full h-96 object-cover rounded-lg shadow-md"/>
                <div class="flex mt-4 space-x-3">
                    <img th:each="image : ${images}" th:src="@{'/images/' + ${image.imageName}}" alt="Hình thu nhỏ xe" class="w-1/5 h-16 object-cover rounded-md shadow-sm"/>
                </div>
            </div>

            <!-- Product Information -->
            <div class="w-full md:w-1/2 md:pl-8 mt-6 md:mt-0">
                <h1 class="text-indigo-600 font-bold uppercase tracking-wide">Xe Hơi Mới Nhất</h1>
                <h2 class="text-3xl font-semibold text-gray-800 mt-2" th:text="${product.name}">Tên Xe Hơi</h2>
                <p class="text-gray-600 mt-4" th:text="${product.description}">Mô tả chi tiết về xe hơi.</p>

                <!-- Pricing and Promotion -->
                <div class="mt-6 flex items-center space-x-4">
                    <span class="line-through text-gray-500 text-xl">₫1,200,000,000</span>
                    <span class="text-red-600 text-4xl font-bold" th:text="${formattedPrice}">₫0</span>
                </div>

                <!-- Stock Information -->
                <div class="mt-6">
                    <span class="text-gray-700 text-lg">Tình Trạng:</span>
                    <span id="quantity-status" class="ml-2 font-bold" th:classappend="${product.quantity > 0 ? 'text-green-600' : 'text-red-600'}">
                        <span th:text="${product.quantity > 0 ? 'Còn hàng' : 'Hết hàng'}"></span>
                    </span>
                    <span class="ml-2 text-sm">
                        (<span id="quantity-available" th:text="${product.quantity}">0</span> chiếc có sẵn)
                    </span>
                </div>

                <!-- Quantity Adjustment -->
                <div class="mt-6">
                    <span class="text-gray-700 text-lg">Số Lượng</span>
                    <div class="flex items-center mt-2 space-x-2">
                        <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l-md focus:outline-none transition duration-200" onclick="adjustQuantity(-1)" th:disabled="${product.quantity == 0}">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input id="quantity" class="w-16 text-center border border-gray-300 rounded focus:ring-2 focus:ring-indigo-300" type="number" value="1" min="1" th:attr="max=${product.quantity}" onchange="validateQuantity()" th:disabled="${product.quantity == 0}"/>
                        <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r-md focus:outline-none transition duration-200" onclick="adjustQuantity(1)" th:disabled="${product.quantity == 0}">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <p id="error-message" class="text-red-500 mt-2 hidden">Số lượng vượt quá mức tồn kho!</p>
                </div>

                <!-- Add to Cart Button -->
                <form id="add-to-cart-form" th:action="@{/cart/add}" method="post">
                    <input type="hidden" name="productId" th:value="${product.id}"/>
                    <input type="hidden" name="quantity" id="hiddenQuantity" value="1"/>
                    <button type="submit" class="mt-6 bg-blue-600 text-white rounded-lg px-6 py-2 font-semibold hover:bg-blue-700 transition duration-300 w-full md:w-auto" th:disabled="${product.quantity == 0}">
                        Thêm Vào Giỏ Hàng
                    </button>
                </form>

                <!-- Success Message -->
                <div id="success-message" class="text-green-600 font-semibold mt-4 hidden">
                    Thêm vào giỏ hàng thành công!
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="mt-5">
    <div class="bg-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-5 gap-4 text-gray-700">
                <div>
                    <h3 class="font-bold mb-2">Sản phẩm</h3>
                    <ul>
                        <li>Hatchback</li>
                        <li>Sedan</li>
                        <li>SUV</li>
                        <li>Đa dụng</li>
                        <li>Thương mại</li>
                        <li>Bán tải</li>
                        <li>Khách hàng dự án</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Công nghệ</h3>
                    <ul>
                        <li>Hybrid</li>
                        <li>TSS</li>
                        <li>TNGA</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Dịch vụ</h3>
                    <ul>
                        <li>Dịch vụ bảo dưỡng</li>
                        <li>Dịch vụ sau bán hàng</li>
                        <li>Sản phẩm chính hãng</li>
                        <li>Cơ sở bảo hành bảo dưỡng</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Tin tức &amp; Khuyến mãi</h3>
                    <ul>
                        <li>Sản phẩm</li>
                        <li>Khuyến mãi</li>
                        <li>Xã hội</li>
                        <li>Thông tin hỗ trợ</li>
                        <li>Thông tin khác</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Về Toyota Việt Nam</h3>
                    <ul>
                        <li>Giới thiệu công ty</li>
                        <li>Tuyển dụng</li>
                        <li>Cộng đồng</li>
                        <li>Nội địa hóa</li>
                        <li>Tạp chí Toyota</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-black text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <h3 class="font-bold mb-2">Công ty ô tô Toyota Việt Nam</h3>
                    <p>Số GCNĐKDN: 2500150335</p>
                    <p>Cấp lần đầu: Ngày 26/03/2007</p>
                    <p>Đăng ký thay đổi lần thứ 20: Ngày 14/08/2024</p>
                    <p>Cơ quan cấp: Sở kế hoạch và đầu tư tỉnh Vĩnh Phúc</p>
                    <p>Địa chỉ: Phường Phúc Thắng, Thành phố Phúc Yên, Tỉnh Vĩnh Phúc, Việt Nam</p>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Đường dây nóng</h3>
                    <p><i class="fas fa-phone-alt"></i> 1800 1524</p>
                    <p><i class="fas fa-phone-alt"></i> 0916 001 524</p>
                    <p><i class="fas fa-envelope"></i> Email</p>
                    <p>Hotline Hỗ trợ tài chính: (84-28) 7309 0998</p>
                    <p>Hotline Bảo hiểm Toyota: 1900 633 884</p>
                    <img alt="Đã thông báo Bộ Công Thương" height="50" src="https://storage.googleapis.com/a1aa/image/WoZazNFnyXKGP10eTtte9VMUNXqDxrRpPaeNHShUAln67QNnA.jpg" width="100"/>
                </div>
                <div>
                    <h3 class="font-bold mb-2">Đăng ký nhận bản tin</h3>
                    <p>Đừng bỏ lỡ những tin tức khuyến mãi của chúng tôi</p>
                    <div class="flex">
                        <input class="p-2 w-full" placeholder="Email" type="email"/>
                        <button class="bg-red-600 p-2 text-white"><i class="fas fa-arrow-right"></i></button>
                    </div>
                    <div class="mt-4">
                        <i class="fab fa-facebook-f text-2xl"></i>
                        <i class="fab fa-youtube text-2xl ml-4"></i>
                    </div>
                </div>
            </div>
            <div class="text-center mt-8">
                <p>Sơ đồ trang | Chính sách và điều khoản | Chính sách bảo mật thông tin cá nhân</p>
                <p>© Bản quyền thuộc về Công ty ô tô Toyota Việt Nam</p>
            </div>
        </div>
    </div>
    <div class="fixed bottom-4 right-4">
        <button class="bg-red-600 p-4 rounded-full text-white"><i class="fas fa-arrow-up"></i></button>
    </div>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        const productId = [[${product.id}]];

        function checkProductQuantity() {
            $.ajax({
                url: `/product/quantity?productId=${productId}`,
                method: 'GET',
                success: function(response) {
                    $('#quantity-available').text(response.quantity);

                    if (response.quantity > 0) {
                        $('#add-to-cart-form button[type="submit"]').removeAttr('disabled');
                        $('#error-message').addClass('hidden');
                    } else {
                        $('#add-to-cart-form button[type="submit"]').attr('disabled', true);
                        $('#error-message').removeClass('hidden').text('Sản phẩm này hiện đã hết hàng.');
                    }
                },
                error: function() {
                    console.error('Có lỗi xảy ra khi cập nhật số lượng sản phẩm.');
                }
            });
        }

        checkProductQuantity();
        setInterval(checkProductQuantity, 5000);
    });

    function adjustQuantity(amount) {
        const quantityInput = document.getElementById("quantity");
        const hiddenQuantity = document.getElementById("hiddenQuantity");
        let currentQuantity = parseInt(quantityInput.value) || 1;
        let newQuantity = currentQuantity + amount;

        if (newQuantity < 1) {
            newQuantity = 1;
        } else if (newQuantity > maxQuantity) {
            newQuantity = maxQuantity;
            document.getElementById("error-message").classList.remove("hidden");
        } else {
            document.getElementById("error-message").classList.add("hidden");
        }

        quantityInput.value = newQuantity;
        hiddenQuantity.value = newQuantity;
    }

    function validateQuantity() {
        const quantityInput = document.getElementById("quantity");
        const hiddenQuantity = document.getElementById("hiddenQuantity");
        const errorMessage = document.getElementById("error-message");
        let currentQuantity = parseInt(quantityInput.value) || 1;

        if (currentQuantity < 1) {
            currentQuantity = 1;
        } else if (currentQuantity > maxQuantity) {
            currentQuantity = maxQuantity;
            errorMessage.classList.remove("hidden");
        } else {
            errorMessage.classList.add("hidden");
        }

        quantityInput.value = currentQuantity;
        hiddenQuantity.value = currentQuantity;
    }

    document.getElementById("quantity").addEventListener("input", validateQuantity);
</script>
<script>
    $(document).ready(function() {
        const productId = /* điền productId vào đây, ví dụ */ 2;
        let currentQuantity = parseInt($('#quantity-available').text());

        function checkProductQuantity() {
            $.ajax({
                url: `/product/quantity?productId=${productId}`,
                method: 'GET',
                success: function(response) {
                    const newQuantity = response.quantity;
                    if (newQuantity !== currentQuantity) {
                        currentQuantity = newQuantity;
                        $('#quantity-available').text(newQuantity);

                        if (newQuantity > 0) {
                            $('#quantity-status').text('Còn hàng').removeClass('text-red-600').addClass('text-green-600');
                            $('#add-to-cart-form button[type="submit"]').removeAttr('disabled');
                            $('#error-message').addClass('hidden');
                        } else {
                            $('#quantity-status').text('Hết hàng').removeClass('text-green-600').addClass('text-red-600');
                            $('#add-to-cart-form button[type="submit"]').attr('disabled', true);
                            $('#error-message').removeClass('hidden').text('Sản phẩm này hiện đã hết hàng.');
                        }
                    }
                },
                error: function() {
                    console.error('Có lỗi xảy ra khi cập nhật số lượng sản phẩm.');
                }
            });
        }

        setInterval(checkProductQuantity, 1000); // Kiểm tra số lượng mỗi 1 giây
    });

</script>

</body>
</html>
